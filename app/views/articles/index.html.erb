<%# app/views/articles/index.html.erb %>

<!DOCTYPE html>
<html>
<head>
  <title>ScrapingApp</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <%= csrf_meta_tags %>
  <%= csp_meta_tag %>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
      background-color: #f0f2f5;
      color: #333;
      margin: 0;
      padding: 2rem;
    }
    .container {
      max-width: 1000px;
      margin: 0 auto;
      background-color: #fff;
      padding: 2rem;
      border-radius: 8px;
      box-shadow: 0 4px 8px rgba(0,0,0,0.1);
    }
    h1 {
      text-align: center;
      color: #1a2c42;
      margin-bottom: 2rem;
    }
    .scrape-form {
      display: flex;
      gap: 1rem;
      margin-bottom: 2.5rem;
    }
    .scrape-form input[type="text"] {
      flex-grow: 1;
      padding: 0.8rem 1rem;
      font-size: 1rem;
      border: 1px solid #ccc;
      border-radius: 4px;
    }
    .scrape-form input[type="submit"] {
      padding: 0.8rem 1.5rem;
      font-size: 1rem;
      font-weight: bold;
      color: #fff;
      background-color: #007bff;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      transition: background-color 0.2s;
    }
    .scrape-form input[type="submit"]:hover {
      background-color: #0056b3;
    }
    .results-table {
      width: 100%;
      border-collapse: collapse;
      table-layout: fixed;
    }
    .results-table th, .results-table td {
      border: 1px solid #ddd;
      padding: 12px;
      text-align: left;
      vertical-align: top;
    }
    .results-table th {
      background-color: #f8f9fa;
      font-weight: bold;
    }
    .results-table td {
      word-wrap: break-word;
    }
    .col-title { width: 25%; }
    .col-score { width: 8%; text-align: center; font-weight: bold; font-size: 1.2rem; }
    .col-summary { width: 32%; }
    .col-body { width: 35%; }

    .notification {
      padding: 1rem;
      margin-bottom: 1rem;
      border-radius: 4px;
    }
    .notice {
      background-color: #d4edda;
      color: #155724;
      border: 1px solid #c3e6cb;
    }
    .alert {
      background-color: #f8d7da;
      color: #721c24;
      border: 1px solid #f5c6cb;
    }
  </style>
</head>

<body>
  <div class="container">
    <h1>スクレイピングアプリケーション</h1>

    <%# 通知メッセージの表示エリア %>
    <% if flash[:notice] %>
      <div class="notification notice"><%= flash[:notice] %></div>
    <% end %>
    <% if flash[:alert] %>
      <div class="notification alert"><%= flash[:alert] %></div>
    <% end %>

    <%# URL入力フォーム %>
    <%= form_with(url: articles_path, method: :post, class: "scrape-form") do |form| %>
      <%= text_field_tag :url, nil, placeholder: "スクレイピングするURLを入力", required: true %>
      <%= form.submit "実行" %>
    <% end %>

    <%# 結果表示テーブル %>
    <table class="results-table">
      <thead>
        <tr>
          <th class="col-title">タイトル</th>
          <th class="col-score">リスクスコア</th>
          <th class="col-summary">要約</th>
          <th class="col-body">本文</th>
        </tr>
      </thead>
      <tbody>
        <% if @articles.any? %>
          <% @articles.each do |article| %>
            <tr>
              <td><%= link_to article.title, article.source_url, target: "_blank" %></td>
              <td style="text-align: center;"><%= article.risk_score %></td>
              <td><%= simple_format(article.summary) %></td>
              <td><%= simple_format(truncate(article.body, length: 300)) %></td>
            </tr>
          <% end %>
        <% else %>
          <tr>
            <td colspan="4" style="text-align: center; padding: 2rem;">まだ分析された記事はありません。</td>
          </tr>
        <% end %>
      </tbody>
    </table>
  </div>
</body>
</html>
